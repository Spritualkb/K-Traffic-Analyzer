# ☯ K-Traffic-Analyzer

**网络流量分析工具 - SQL注入 & WebShell 自动检测解密分析**

作者: **Spritualkb**

---

## 📖 简介

K-Traffic-Analyzer 是一款专业的网络流量分析工具，专注于安全分析场景。支持自动检测和解密多种攻击流量，包括：

- **SQL注入检测**: 布尔盲注、时间盲注自动识别与数据提取
- **WebShell分析**: 冰蝎(Behinder)、哥斯拉(Godzilla)、蚁剑(AntSword)、菜刀(CKnife) 流量解密
- **WebShell上传检测**: PHP/JSP/ASP/ASPX 恶意文件上传识别
- **文件提取**: 自动提取图片、音频、视频、文档、压缩包等文件

## ✨ 特性

- 🌐 **Web界面**: 现代化的深色主题UI，支持拖拽上传
- 🔍 **高级搜索**: 支持按关键词、HTTP方法、状态码等多维度搜索
- 📊 **可视化分析**: 直观的统计面板和分析结果展示
- 🔗 **流追踪**: 支持TCP/UDP/DCCP/TLS/HTTP/HTTP2/QUIC/SIP/DNS等协议的流追踪
- 💾 **SQLite存储**: 高效的本地数据存储，支持多数据包管理
- 🚀 **单文件部署**: 编译后为单个可执行文件，开箱即用
- 🔒 **离线运行**: 无需联网，保护敏感数据安全

## 🚀 快速开始

### 📋 命令行参数

| 参数   | 说明         | 默认值  |
| ------ | ------------ | ------- |
| `-p` | 服务端口     | 8080    |
| `-h` | 监听地址     | 0.0.0.0 |
| `-d` | 数据目录     | ./data  |
| `-v` | 显示版本信息 | -       |

## 🖥️ 使用说明

### 1. 启动服务

```bash
./k-traffic-analyzer -p 8080
```

启动后访问 `http://127.0.0.1:8080`

### 2. 上传数据包

- 支持 `.pcap` 和 `.pcapng` 格式
- 可拖拽文件到上传区域
- 也可点击按钮选择文件

### 3. 查看分析结果

上传完成后自动分析，可查看：

- **概览**: 统计信息和提取的关键数据
- **HTTP流量**: 所有HTTP请求/响应，支持搜索过滤
- **SQL注入**: 检测到的注入攻击和提取的数据
- **WebShell**: 检测到的WebShell会话和执行的命令
- **提取文件**: 从流量中提取的文件，可下载

### 4. 高级搜索

在HTTP流量页面，支持：

- **关键词搜索**: 搜索URI、请求体、响应体中的内容
- **方法过滤**: 按GET/POST/PUT/DELETE过滤
- **字段选择**: 选择搜索的字段范围

## 🔧 支持的检测类型

### SQL注入

| 类型     | 说明                    |
| -------- | ----------------------- |
| 布尔盲注 | 基于响应差异的字符猜解  |
| 时间盲注 | 基于SLEEP延时的字符猜解 |

自动提取：数据库名、表名、列名、数据内容

### WebShell

| 类型              | 说明              | 解密支持 |
| ----------------- | ----------------- | -------- |
| 冰蝎 (Behinder)   | AES加密通信       | ✅       |
| 哥斯拉 (Godzilla) | 自定义加密        | ✅       |
| 蚁剑 (AntSword)   | Base64/自定义编码 | ✅       |
| 菜刀 (CKnife)     | Base64编码        | ✅       |

自动解析：执行的命令、读取的文件、操作类型

### 文件提取

| 类型   | 格式                              |
| ------ | --------------------------------- |
| 图片   | PNG, JPEG, GIF, BMP, WebP         |
| 音频   | MP3, WAV, OGG, FLAC               |
| 视频   | MP4, AVI, MKV, WebM               |
| 文档   | PDF, DOC/DOCX, XLS/XLSX, PPT/PPTX |
| 压缩包 | ZIP, RAR, 7z, GZIP, TAR           |

### 流追踪 (Follow Stream)

支持以下协议的流/连接追踪：

| 协议   | 说明          | 特性                  |
| ------ | ------------- | --------------------- |
| TCP    | TCP连接追踪   | 自动重组双向数据流    |
| UDP    | UDP数据流追踪 | 按会话分组            |
| DCCP   | DCCP协议追踪  | 数据报拥塞控制协议    |
| TLS    | TLS加密连接   | 自动提取SNI、TLS版本  |
| HTTP   | HTTP请求/响应 | 提取Host、Method、URI |
| HTTP/2 | HTTP/2协议    | 支持h2c和ALPN检测     |
| DNS    | DNS查询追踪   | 端口53自动识别        |
| SIP    | SIP协议追踪   | VoIP信令协议          |
| QUIC   | QUIC协议追踪  | UDP上的加密传输       |

**流追踪功能特点：**

- 🔄 **流重组**: 自动将双向数据包重组为完整的会话
- 👁️ **多视图模式**: ASCII视图、Hex Dump视图、仅客户端/服务端数据
- 🔍 **协议自动检测**: 根据端口和数据特征自动识别协议类型
- 🔐 **TLS解析**: 提取ClientHello中的SNI和TLS版本
- 📊 **统计信息**: 显示各类型流的数量统计

## 🛡️ 安全建议

- 建议在内网或本地环境使用
- 敏感数据包分析完成后及时删除
- 定期清理数据目录

## 📝 更新日志

### v1.1.0

- 新增流追踪功能 (Follow Stream)
- 支持TCP/UDP/DCCP/TLS/HTTP/HTTP2/QUIC/SIP/DNS协议追踪
- 自动检测TLS版本和SNI
- 支持HTTP/2协议检测 (h2c和ALPN)
- 多视图模式：ASCII、Hex Dump、客户端/服务端分离
- 流统计信息展示

### v1.0.0

- 初始版本发布
- 支持SQL注入检测（布尔盲注、时间盲注）
- 支持WebShell检测（冰蝎、哥斯拉、蚁剑、菜刀）
- 支持WebShell上传检测
- 支持文件提取
- Web界面支持

## 📄 许可证

MIT License

## 🙏 致谢

- [gopacket](https://github.com/google/gopacket) - 网络数据包处理
- [gin](https://github.com/gin-gonic/gin) - Web框架
- [Vue.js](https://vuejs.org/) - 前端框架

---

**Made with ❤️ by Spritualkb**
